<!DOCTYPE html>
<html>
<head>
    <title>Drilling and Lowering Completion</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>
    <div id="drilling-chart"></div>
    <div id="lowering-chart"></div>
    <div id="pipe-laying-pie-chart"></div>
    <div id="pipe-laying-progress-pie-chart"></div>

    <script>
        // Fetch data from the CSV file
        fetch('https://zorawer.github.io/jjmproject/testfetch.csv')
            .then(response => response.text())
            .then(data => {
                // Process the data
                const parsedData = Plotly.d3.csv.parse(data);

                // Group the data by D/N Pipe Laying Status
                const pipeLayingStatusData = parsedData.reduce((accumulator, row) => {
                    const status = row['D/N Pipe Laying Status'];
                    if (status === 'WIP') {
                        if (accumulator.hasOwnProperty(status)) {
                            accumulator[status]++;
                        } else {
                            accumulator[status] = 1;
                        }
                    }
                    return accumulator;
                }, {});

                // Create the pipe laying pie chart data
                const pipeLayingLabels = ['WIP'];
                const pipeLayingValues = [pipeLayingStatusData['WIP'] || 0];

                // Create the pipe laying pie chart
                const pipeLayingPieChart = {
                    labels: pipeLayingLabels,
                    values: pipeLayingValues,
                    type: 'pie'
                };

                const pipeLayingPieLayout = {
                    title: 'D/N Pipe Laying Status',
                };

                // Create the pipe laying pie chart
                Plotly.newPlot('pipe-laying-pie-chart', [pipeLayingPieChart], pipeLayingPieLayout);


                // Calculate the progress in the WIP schemes for pipe laying
                const wipSchemes = parsedData.filter(row => row['D/N Pipe Laying Status'] === 'WIP');
                const totalWipSchemes = wipSchemes.length;
                const completedLength = wipSchemes.reduce((total, row) => total + parseInt(row['D/N Pipe Laying (m)']), 0);

                // Calculate the remaining length in the WIP schemes
                const remainingLength = wipSchemes.reduce((total, row) => total + parseInt(row['Distribution System Length']) - parseInt(row['D/N Pipe Laying (m)']), 0);

                // Create the pipe laying progress pie chart data
                const progressLabels = ['Completed', 'Remaining'];
                const progressValues = [completedLength, remainingLength];

                // Create the pipe laying progress pie chart
                const progressPieChart = {
                    labels: progressLabels,
                    values: progressValues,
                    type: 'pie'
                };

                const progressPieLayout = {
                    title: `Pipe Laying Progress (${totalWipSchemes} WIP Schemes)`,
                };

                // Create the pipe laying progress pie chart
                Plotly.newPlot('pipe-laying-progress-pie-chart', [progressPieChart], progressPieLayout);
            })
            .catch(error => console.error(error));
    </script>
</body>
</html>
