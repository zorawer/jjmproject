<!DOCTYPE html>
<html>
<head>
    <title>Drilling and Lowering Completion</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>
    <div id="dn-pipe-laying-started-chart"></div>
    <div id="dn-pipe-laying-progress-chart"></div>

    <script>
        // Fetch data from the CSV file
        fetch('https://zorawer.github.io/jjmproject/testfetch.csv')
            .then(response => response.text())
            .then(data => {
                // Process the data
                const parsedData = Plotly.d3.csv.parse(data);

                // Calculate the total number of schemes
                const totalSchemes = parsedData.length;

                // Filter the schemes with D/N Pipe Laying Status as 'Started'
                const startedSchemes = parsedData.filter(row => row['D/N Pipe Laying Status'] === 'Started');
                const startedCount = startedSchemes.length;

                // Filter the schemes with D/N Pipe Laying Status as 'WIP'
                const wipSchemes = parsedData.filter(row => row['D/N Pipe Laying Status'] === 'WIP');
                const wipCount = wipSchemes.length;

                // Calculate the total scope for WIP schemes
                const wipScope = wipSchemes.reduce((total, row) => total + parseInt(row['Distribution System Length']), 0);

                // Calculate the total work completed for WIP schemes
                const wipWorkCompleted = wipSchemes.reduce((total, row) => total + parseInt(row['D/N Excavation (m)']), 0);

                // Create the D/N Pipe Laying Started pie chart data
                const startedLabels = ['Started', 'Remaining'];
                const startedValues = [startedCount, totalSchemes - startedCount];

                // Create the D/N Pipe Laying Started pie chart
                const startedPieChart = {
                    labels: startedLabels,
                    values: startedValues,
                    type: 'pie'
                };

                const startedPieLayout = {
                    title: `D/N Pipe Laying Started (${totalSchemes} Schemes)`,
                };

                // Create the D/N Pipe Laying Started pie chart
                Plotly.newPlot('dn-pipe-laying-started-chart', [startedPieChart], startedPieLayout);


                // Calculate the remaining work for WIP schemes
                const wipRemainingWork = wipScope - wipWorkCompleted;

                // Create the D/N Pipe Laying Progress pie chart data
                const progressLabels = ['Work Completed', 'Remaining'];
                const progressValues = [wipWorkCompleted, wipRemainingWork];

                // Create the D/N Pipe Laying Progress pie chart
                const progressPieChart = {
                    labels: progressLabels,
                    values: progressValues,
                    type: 'pie'
                };

                const progressPieLayout = {
                    title: `D/N Pipe Laying Progress (${wipCount} WIP Schemes)`,
                };

                // Create the D/N Pipe Laying Progress pie chart
                Plotly.newPlot('dn-pipe-laying-progress-chart', [progressPieChart], progressPieLayout);
            })
            .catch(error => console.error(error));
    </script>
</body>
</html>
