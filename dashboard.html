<!DOCTYPE html>
<html>
<head>
    <title>Drilling and Lowering Completion</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>
    <div id="drilling-chart"></div>
    <div id="lowering-chart"></div>

    <script>
        // Fetch data from the CSV file
        fetch('https://zorawer.github.io/jjmproject/testfetch.csv')
            .then(response => response.text())
            .then(data => {
                // Process the data
                const parsedData = Plotly.d3.csv.parse(data);

                // Group the data by month for drilling completion
                const drillingData = parsedData.reduce((accumulator, row) => {
                    if (row['Drilling Status'] === 'Completed' && row['T/W Drill Start Date']) {
                        const dateParts = row['T/W Drill Start Date'].split('/');
                        const month = new Date(dateParts[2], dateParts[1] - 1, dateParts[0]).toLocaleString('default', { month: 'long' });
                        if (accumulator.hasOwnProperty(month)) {
                            accumulator[month].completed += 1;
                        } else {
                            accumulator[month] = {
                                completed: 1,
                                wip: 0
                            };
                        }
                    } else {
                        const dateParts = row['T/W Drill Start Date'].split('/');
                        const month = new Date(dateParts[2], dateParts[1] - 1, dateParts[0]).toLocaleString('default', { month: 'long' });
                        if (accumulator.hasOwnProperty(month)) {
                            accumulator[month].wip += 1;
                        } else {
                            accumulator[month] = {
                                completed: 0,
                                wip: 1
                            };
                        }
                    }
                    return accumulator;
                }, {});

                // Sort the drilling months in chronological order
                const drillingMonths = Object.keys(drillingData).sort((a, b) => new Date(a + '-01-01') - new Date(b + '-01-01'));

                // Create the drilling chart data
                const drillingCompletedCounts = drillingMonths.map(month => drillingData[month].completed);
                const drillingWIPCounts = drillingMonths.map(month => drillingData[month].wip);

                // Calculate total drilling completions
                const totalDrillingCompletions = drillingCompletedCounts.reduce((total, count) => total + count, 0);
                const totalDrillingWIP = drillingWIPCounts.reduce((total, count) => total + count, 0);

                // Create the drilling chart
                const drillingChart = {
                    x: drillingMonths,
                    y: drillingCompletedCounts,
                    type: 'scatter',
                    mode: 'lines+markers',
                    name: `Completed (${totalDrillingCompletions})`
                };

                const drillingWIPChart = {
                    x: drillingMonths,
                    y: drillingWIPCounts,
                    type: 'scatter',
                    mode: 'lines+markers',
                    name: `WIP (${totalDrillingWIP})`
                };

                const drillingLayout = {
                    title: 'Drilling Completion by Month',
                    xaxis: {
                        title: 'Month'
                    },
                    yaxis: {
                        title: 'Number of Drilling Schemes',
                        range: [0, Math.max(...drillingCompletedCounts, drillingWIPCounts)], // Set the range from zero to the maximum count
                        rangemode: 'normal'
                    },
                    legend: {
                        x: 1,
                        y: 1,
                        traceorder: 'normal',
                        font: {
                            family: 'sans-serif',
                            size: 12,
                            color: '#000'
                        },
                        bgcolor: '#E2E2E2',
                        bordercolor: '#FFFFFF',
                        borderwidth: 2
                    }
                };

                // Create the drilling chart
                Plotly.newPlot('drilling-chart', [drillingChart, drillingWIPChart], drillingLayout);


                // Group the data by month for lowering completion
                const loweringData = parsedData.reduce((accumulator, row) => {
                    if (row['T/W Lowering Status'] === 'Completed' && row['T/W Lowering Date']) {
                        const dateParts = row['T/W Lowering Date'].split('/');
                        const month = new Date(dateParts[2], dateParts[1] - 1, dateParts[0]).toLocaleString('default', { month: 'long' });
                        if (accumulator.hasOwnProperty(month)) {
                            accumulator[month].completed += 1;
                        } else {
                            accumulator[month] = {
                                completed: 1,
                                wip: 0
                            };
                        }
                    } else {
                        const dateParts = row['T/W Lowering Date'].split('/');
                        const month = new Date(dateParts[2], dateParts[1] - 1, dateParts[0]).toLocaleString('default', { month: 'long' });
                        if (accumulator.hasOwnProperty(month)) {
                            accumulator[month].wip += 1;
                        } else {
                            accumulator[month] = {
                                completed: 0,
                                wip: 1
                            };
                        }
                    }
                    return accumulator;
                }, {});

                // Sort the lowering months in chronological order
                const loweringMonths = Object.keys(loweringData).sort((a, b) => new Date(a + '-01-01') - new Date(b + '-01-01'));

                // Create the lowering chart data
                const loweringCompletedCounts = loweringMonths.map(month => loweringData[month].completed);
                const loweringWIPCounts = loweringMonths.map(month => loweringData[month].wip);

                // Calculate total lowering completions
                const totalLoweringCompletions = loweringCompletedCounts.reduce((total, count) => total + count, 0);
                const totalLoweringWIP = loweringWIPCounts.reduce((total, count) => total + count, 0);

                // Create the lowering chart
                const loweringChart = {
                    x: loweringMonths,
                    y: loweringCompletedCounts,
                    type: 'scatter',
                    mode: 'lines+markers',
                    name: `Completed (${totalLoweringCompletions})`,
                    marker: {
                        color: '#FFA500'
                    }
                };

                const loweringWIPChart = {
                    x: loweringMonths,
                    y: loweringWIPCounts,
                    type: 'scatter',
                    mode: 'lines+markers',
                    name: `WIP (${totalLoweringWIP})`,
                    marker: {
                        color: '#FFA500'
                    }
                };

                const loweringLayout = {
                    title: 'Lowering Completion by Month',
                    xaxis: {
                        title: 'Month'
                    },
                    yaxis: {
                        title: 'Number of Lowering Schemes',
                        range: [0, Math.max(...loweringCompletedCounts, loweringWIPCounts)], // Set the range from zero to the maximum count
                        rangemode: 'normal'
                    },
                    legend: {
                        x: 1,
                        y: 1,
                        traceorder: 'normal',
                        font:
