<!DOCTYPE html>
<html>
<head>
    <title>Drilling and Lowering Completion</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        .chart-container {
            display: flex;
            justify-content: space-between;
        }
    </style>
</head>
<body>
    <h1>JJM - HFCL Project Dashboard</h1>

    <div class="chart-container">
        <div id="drilling-chart"></div>
        <div id="lowering-chart"></div>
    </div>
    <div class="chart-container">
        <div id="pipe-laying-pie-chart"></div>
        <div id="wip-pie-chart"></div>
    </div>
    <ul id="wip-scheme-list"></ul>

    <script>
        // Fetch data from the CSV file on GitHub
        fetch('https://raw.githubusercontent.com/zorawer/jjmproject/main/testfetch.csv')
            .then(response => response.text())
            .then(data => {
                // Process the data
                const parsedData = Plotly.d3.csv.parse(data);

                // Group the data by month for drilling completion
                // ... (code for grouping by month for drilling completion)

                // Create the drilling chart
                // ... (code for drilling completion chart)

                // Group the data by month for lowering completion
                // ... (code for grouping by month for lowering completion)

                // Create the lowering chart
                // ... (code for lowering completion chart)

                // Group the data by D/N Pipe Laying Status
                // ... (code for grouping by D/N Pipe Laying Status)

                // Create the pipe laying status pie chart
                // ... (code for creating pipe laying status pie chart)

                // Filter the data for WIP schemes in D/N pipe laying
                const wipData = parsedData.filter(row => row['D/N Pipe Laying Status'] === 'WIP');

                // Create the pie chart for WIP schemes in D/N pipe laying
                // ... (code for creating WIP pie chart)

                // Attach click event handler to WIP pie chart
                const wipPieChartElement = document.getElementById('wip-pie-chart');
                wipPieChartElement.on('plotly_click', event => {
                    const label = event.points[0].label;
                    if (label === 'WIP') {
                        document.getElementById('wip-scheme-list').innerHTML = ''; // Clear previous list
                        wipData.forEach(row => {
                            const schemeID = row['Scheme ID'];
                            const schemeName = row['Scheme Name'];
                            const listItem = document.createElement('li');
                            listItem.innerHTML = `${schemeID} - ${schemeName}`;
                            document.getElementById('wip-scheme-list').appendChild(listItem);
                        });
                    }
                });

                // Function to open new tab with scheme details
                function openSchemeDetails(id) {
                    if (parsedData) {
                        const scheme = parsedData.find(row => row['Scheme ID'] === id);
                        if (scheme) {
                            const schemeDetails = `Scheme ID: ${scheme['Scheme ID']}\nScheme Name: ${scheme['Scheme Name']}\nDistrict: ${scheme['District']}\nBlock: ${scheme['Block']}\nT/W Vendor: ${scheme['T/W Vendor']}`;
                            const schemeDetailsWindow = window.open();
                            schemeDetailsWindow.document.write(`<pre>${schemeDetails}</pre>`);
                            schemeDetailsWindow.document.close();
                        }
                    }
                }
            })
            .catch(error => console.error(error));
    </script>
</body>
</html>
